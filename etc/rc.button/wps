#!/bin/sh

if [ "$ACTION" = "pressed" -a "$BUTTON" = "wps" ]; then

	WPSLED="/sys/class/leds/wndr4700:white:logo/brightness"
	
	(
		for i in $(seq 0 59); 
		do 
			echo 1 > $WPSLED
			sleep 1
			echo 0 > $WPSLED
			sleep 1
		done 
	) &                               # content in ()& is forked child in backgroung 

		cd /var/run/hostapd
		for socket in *; do
			[ -S "$socket" ] || continue
			hostapd_cli -i "$socket" wps_pbc
		done
	echo 0 > $WPSLED	            # set wps-led off just to make sure might not nededed
	pkill -TERM -P $$         #kill all child having parent pid as "wps" pid 
fi
return 0
